<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Inventory Capture – Zebra TC32</title>
  <style>
    :root {
      --bg: #0b1220; --card:#121a2b; --muted:#8ea0c4; --text:#e6eefc; --accent:#4da3ff; --ok:#2fbf71; --bad:#ff5c5c; --warn:#f5a524; --radius:16px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,Noto Sans; background:var(--bg); color:var(--text)}
    header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,rgba(11,18,32,.95),rgba(11,18,32,.85));backdrop-filter:saturate(120%) blur(8px);padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.06)}
    header h1{margin:0;font-size:20px;letter-spacing:.3px}
    main{padding:16px;max-width:1100px;margin:0 auto}
    .card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:var(--radius);padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .row{display:grid;grid-template-columns:1fr;gap:12px}
    @media (min-width:760px){.row.two{grid-template-columns:repeat(2,1fr)}.row.three{grid-template-columns:repeat(3,1fr)}.row.four{grid-template-columns:repeat(4,1fr)}}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input,select,button,textarea{width:100%;padding:14px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:#0d1526;color:var(--text);font-size:16px;outline:none}
    input:focus,select:focus,textarea:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(77,163,255,.25)}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
    .btn{cursor:pointer;border:1px solid rgba(255,255,255,.12);background:#0e1931;font-weight:600}
    .btn.primary{background:linear-gradient(180deg,#2a7aff,#1864ff);border-color:#2a7aff}
    .btn.ghost{background:transparent}
    .hint{font-size:12px;color:var(--muted);margin-top:6px}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;font-size:12px;border:1px solid rgba(255,255,255,.12);background:#0f1730}
    .readonly{background:#0a1326;color:#b9c7e6}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}
    .toast{position:fixed;left:16px;right:16px;bottom:16px;display:none;padding:14px 16px;border-radius:12px;background:#0f1a33;border:1px solid rgba(255,255,255,.12);box-shadow:0 18px 40px rgba(0,0,0,.45)}
    .toast.show{display:block}
    .divider{height:1px;background:rgba(255,255,255,.06);margin:14px 0}
    .list{margin-top:10px}
    .list-item{display:grid;grid-template-columns:1fr auto;gap:8px;padding:10px 0;border-bottom:1px dashed rgba(255,255,255,.08)}
    .list-item:last-child{border-bottom:none}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:13px}
    .tabbar{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin:12px 0 16px}
    .tabbar button{padding:10px;font-weight:700}
    .tabbar button.active{background:#173063;border-color:#3157a8}
    .status{font-size:12px}
    .queue-table{width:100%;border-collapse:collapse}
    .queue-table th,.queue-table td{border-bottom:1px solid rgba(255,255,255,.08);padding:8px}
    .queue-table th{font-size:12px;color:var(--muted);text-align:left}
    .mini{padding:10px 10px;font-size:14px;border-radius:10px}
  </style>
</head>
<body>
  <header>
    <h1>Inventory Capture</h1>
    <div class="hint">Optimized for Zebra TC32 scanners (DataWedge friendly)</div>
  </header>
  <main>
    <section class="card">
      <nav class="tabbar">
        <button id="tab-single" class="active">New Inventory</button>
        <button id="tab-batch">Batch Scan</button>
        <button id="tab-review">Review Queue</button>
      </nav>

      <!-- SINGLE ENTRY -->
      <div id="view-single">
        <div class="row two">
          <div>
            <label for="hardwareType">Hardware type</label>
            <select id="hardwareType" required>
              <option value="" selected disabled>Select a type…</option>
              <option value="desktop">Desktop</option>
              <option value="laptop">Laptop</option>
              <option value="printer">Printer</option>
              <option value="tablet">Tablet</option>
            </select>
          </div>
          <div>
            <label for="assetTag">Asset tag</label>
            <input id="assetTag" inputmode="numeric" placeholder="Scan or type asset tag" autocomplete="off" />
            <div class="hint">Tip: set DataWedge to focus this field for scans.</div>
          </div>
        </div>
        <div class="row two" style="margin-top:12px;">
          <div>
            <label for="serialNumber">Serial number</label>
            <input id="serialNumber" placeholder="Scan serial barcode" autocomplete="off" />
          </div>
          <div id="modelContainer">
            <label for="model">Model</label>
            <select id="model" disabled>
              <option value="" selected>Select hardware type first…</option>
            </select>
          </div>
        </div>
        <div class="divider"></div>
        <div class="row three">
          <div>
            <label for="productNumber">Product Number</label>
            <input id="productNumber" class="readonly" readonly />
          </div>
          <div>
            <label for="typeField">Type</label>
            <input id="typeField" class="readonly" readonly />
          </div>
          <div>
            <label for="manufacturer">Manufacturer</label>
            <input id="manufacturer" class="readonly" readonly />
          </div>
        </div>
        <div class="row" style="margin-top:12px;">
          <div>
            <label for="notes">Notes (optional)</label>
            <textarea id="notes" rows="3" placeholder="Any extra info (location, PO, user, etc.)"></textarea>
          </div>
        </div>
        <div class="actions">
          <button id="submitBtn" class="btn primary">Submit to Sheet</button>
          <button id="addToQueueBtn" class="btn">Add to Queue</button>
          <button id="resetBtn" class="btn ghost" type="button">Clear</button>
          <span class="pill">Sheet: <strong class="mono">New Equipment</strong></span>
        </div>
      </div>

      <!-- BATCH SCAN -->
      <div id="view-batch" style="display:none">
        <div class="row two">
          <div>
            <label for="batchType">Hardware type</label>
            <select id="batchType">
              <option value="" selected disabled>Select a type…</option>
              <option value="desktop">Desktop</option>
              <option value="laptop">Laptop</option>
              <option value="printer">Printer</option>
              <option value="tablet">Tablet</option>
            </select>
          </div>
          <div>
            <label for="batchModel">Model</label>
            <select id="batchModel" disabled>
              <option value="" selected>Select type first…</option>
            </select>
            <div class="hint">Model defaults here; you can change per item later in Review.</div>
          </div>
        </div>
        <div class="row two" style="margin-top:12px;">
          <div>
            <label for="batchAsset">Asset tag</label>
            <input id="batchAsset" inputmode="numeric" placeholder="Scan asset tag" autocomplete="off" />
          </div>
          <div>
            <label for="batchSerial">Serial number</label>
            <input id="batchSerial" placeholder="Scan serial" autocomplete="off" />
          </div>
        </div>
        <div class="actions">
          <button id="batchAddBtn" class="btn primary">Add to Queue</button>
          <button id="goReviewBtn" class="btn">Go to Review</button>
        </div>
        <div class="hint" style="margin-top:8px;">Pro tip: set DataWedge to auto-tab/enter after scan to speed up.</div>
      </div>

      <!-- REVIEW QUEUE -->
      <div id="view-review" style="display:none">
        <div class="actions" style="margin-bottom:8px;">
          <button id="submitAllBtn" class="btn primary">Submit All to Sheet</button>
          <button id="clearQueueBtn" class="btn ghost">Clear Queue</button>
          <span class="pill" id="queueCountPill">0 items</span>
        </div>
        <div class="hint">Edit inline before submitting. Values like Product Number/Type/Manufacturer auto-fill from model.</div>
        <div class="divider"></div>
        <div style="overflow:auto;">
          <table class="queue-table" id="queueTable">
            <thead>
              <tr>
                <th>#</th>
                <th>Type</th>
                <th>Model</th>
                <th>Asset Tag</th>
                <th>Serial</th>
                <th>Product #</th>
                <th>Manufacturer</th>
                <th>Notes</th>
                <th>Actions</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="queueBody"></tbody>
          </table>
        </div>
      </div>

      <div class="toast" id="toast" role="status" aria-live="polite"></div>
    </section>

    <section class="card" style="margin-top:16px;">
      <div class="row">
        <div>
          <strong>Recent submissions (device local)</strong>
          <div class="hint">Saved in this browser for quick recall. Clears on reset/site data wipe.</div>
          <div id="recent" class="list"></div>
        </div>
      </div>
    </section>
  </main>

  <script>
    // ==== CONFIGURE THIS ENDPOINT ====
    const API_URL = "https://script.google.com/macros/s/AKfycbzG03x73sbgYLMFPaPIrc624A_fWDu6YjPQWJzSmt6OCTA-qFdMGcDOe5PQV2eTrMthog/exec"; // TODO: set real endpoint
    const API_HEADERS = { "Content-Type": "application/json" /*, "X-Api-Key": "..." */ };
    const SHEET_NAME = "New Equipment";

    // ==== MODEL DEFINITIONS & AUTOFILL RULES ====
    const MODELS = {
      desktop: {
        "ELITEONE 840 G9 23IN NON-TOUCH AiO": { productNumber: "BF0H0US", type: "Desktop", manufacturer: "HP" },
        "ELITEONE 840 G10 23IN NON-TOUCH AiO": { productNumber: "BF0H0US@", type: "Desktop", manufacturer: "HP" },
      },
      laptop: {
        "ELITETwo 840 G9 23IN NON-TOUCH AiO": { productNumber: "BF0H0US", type: "Laptop", manufacturer: "HP" },
        "ELITETwo 840 G10 23IN NON-TOUCH AiO": { productNumber: "BF0H0US@", type: "Laptop", manufacturer: "HP" },
      },
      printer: {},
      tablet: {},
    };

    // ==== DOM (single) ====
    const hardwareTypeEl = document.getElementById('hardwareType');
    const assetTagEl = document.getElementById('assetTag');
    const serialEl = document.getElementById('serialNumber');
    const modelEl = document.getElementById('model');
    const productEl = document.getElementById('productNumber');
    const typeEl = document.getElementById('typeField');
    const mfgEl = document.getElementById('manufacturer');
    const notesEl = document.getElementById('notes');

    // ==== DOM (batch) ====
    const batchTypeEl = document.getElementById('batchType');
    const batchModelEl = document.getElementById('batchModel');
    const batchAssetEl = document.getElementById('batchAsset');
    const batchSerialEl = document.getElementById('batchSerial');

    // ==== DOM (review) ====
    const queueBody = document.getElementById('queueBody');
    const queueCountPill = document.getElementById('queueCountPill');

    // ==== Misc DOM ====
    const toastEl = document.getElementById('toast');
    const recentEl = document.getElementById('recent');

    // ==== Tabs ====
    const viewSingle = document.getElementById('view-single');
    const viewBatch = document.getElementById('view-batch');
    const viewReview = document.getElementById('view-review');
    const tabSingle = document.getElementById('tab-single');
    const tabBatch = document.getElementById('tab-batch');
    const tabReview = document.getElementById('tab-review');

    function setTab(which){
      const map = {single:viewSingle, batch:viewBatch, review:viewReview};
      for(const [k,el] of Object.entries(map)) el.style.display = (k===which)?'block':'none';
      for(const b of [tabSingle,tabBatch,tabReview]) b.classList.remove('active');
      (which==='single'?tabSingle:which==='batch'?tabBatch:tabReview).classList.add('active');
      if(which==='single') assetTagEl.focus();
      if(which==='batch') batchAssetEl.focus();
      if(which==='review') renderQueue();
    }
    tabSingle.onclick=()=>setTab('single');
    tabBatch.onclick=()=>setTab('batch');
    tabReview.onclick=()=>setTab('review');

    // ==== Helpers ====
    function showToast(msg, kind='info'){
      toastEl.textContent = msg;
      toastEl.style.borderColor = kind==='ok'? 'var(--ok)': kind==='bad'? 'var(--bad)': kind==='warn'? 'var(--warn)': 'rgba(255,255,255,.12)';
      toastEl.classList.add('show');
      setTimeout(()=>toastEl.classList.remove('show'), 2600);
    }
    function capitalize(s){return s? s.charAt(0).toUpperCase()+s.slice(1): s}
    function fillModelOptionsFor(selectEl, kind){
      selectEl.innerHTML='';
      const opts = MODELS[kind]||{}; const has = Object.keys(opts).length>0;
      selectEl.disabled = !has;
      if(!has){ const o=document.createElement('option'); o.value=''; o.textContent='No preset models — type in Notes'; selectEl.appendChild(o); return; }
      const ph=document.createElement('option'); ph.value=''; ph.selected=true; ph.disabled=true; ph.textContent='Select a model…'; selectEl.appendChild(ph);
      for(const name of Object.keys(opts)){ const o=document.createElement('option'); o.value=name; o.textContent=name; selectEl.appendChild(o); }
    }

    function autofillFrom(kind, modelName){
      const rule = MODELS[kind]?.[modelName];
      if(!rule) return {productNumber:'', type: capitalize(kind), manufacturer:''};
      return {productNumber: rule.productNumber||'', type: rule.type||capitalize(kind), manufacturer: rule.manufacturer||''};
    }

    function recentKey(){return 'inv_recent_v1'}
    function queueKey(){return 'inv_queue_v1'}

    function getQueue(){
      try{ return JSON.parse(localStorage.getItem(queueKey())||'[]'); }catch{ return [] }
    }
    function setQueue(arr){ try{ localStorage.setItem(queueKey(), JSON.stringify(arr)); }catch{} }

    function saveRecent(item){
      try{ const key=recentKey(); const arr=JSON.parse(localStorage.getItem(key)||'[]'); arr.unshift(item); while(arr.length>10) arr.pop(); localStorage.setItem(key, JSON.stringify(arr)); renderRecent(); }catch{}
    }
    function renderRecent(){
      let arr=[]; try{ arr=JSON.parse(localStorage.getItem(recentKey())||'[]'); }catch{}
      recentEl.innerHTML='';
      if(!arr.length){ recentEl.innerHTML='<div class="hint">No submissions yet.</div>'; return; }
      arr.forEach(item=>{
        const div=document.createElement('div'); div.className='list-item';
        div.innerHTML=`<div><div class="mono">${item.assetTag} · ${item.serialNumber}</div><div class="hint">${item.hardwareType} · ${item.model||'—'} · ${new Date(item.timestamp).toLocaleString()}</div></div><div class="pill">${item.type||''}</div>`;
        recentEl.appendChild(div);
      });
    }

    function payloadFromFields(kind, asset, serial, modelName, notes){
      const auto = autofillFrom(kind, modelName);
      return {
        sheet: SHEET_NAME,
        timestamp: new Date().toISOString(),
        hardwareType: kind,
        assetTag: String(asset||'').trim(),
        serialNumber: String(serial||'').trim(),
        model: String(modelName||'').trim(),
        productNumber: String(auto.productNumber||'').trim(),
        type: String(auto.type||'').trim(),
        manufacturer: String(auto.manufacturer||'').trim(),
        notes: String(notes||'').trim(),
      }
    }

    function validateSingle(){
      const errs=[]; if(!hardwareTypeEl.value) errs.push('Hardware type is required'); if(!assetTagEl.value) errs.push('Asset tag is required'); if(!serialEl.value) errs.push('Serial number is required');
      if(MODELS[hardwareTypeEl.value] && Object.keys(MODELS[hardwareTypeEl.value]).length && !modelEl.value) errs.push('Model must be selected');
      return errs;
    }

    async function postItem(body, statusCell){
      try{
        const res = await fetch(API_URL,{method:'POST', headers:API_HEADERS, body:JSON.stringify(body)});
        if(!res.ok) throw new Error('HTTP '+res.status);
        const data = await res.json().catch(()=>({}));
        if(statusCell) statusCell.textContent = '✅';
        showToast(data.message||'Submitted ✅','ok');
        saveRecent(body);
        return {ok:true};
      }catch(err){
        if(statusCell) statusCell.textContent = '❌';
        showToast('Network/API error — check endpoint','bad');
        return {ok:false, error:String(err)}
      }
    }

    // ==== Single entry events ====
    function fillModelOptions(kind){ fillModelOptionsFor(modelEl, kind); productEl.value=''; typeEl.value=kind?capitalize(kind):''; mfgEl.value=''; }
    hardwareTypeEl.addEventListener('change', e=>{ fillModelOptions(e.target.value); setTimeout(()=>assetTagEl.focus(),0); });
    modelEl.addEventListener('change', e=>{ const rule = autofillFrom(hardwareTypeEl.value, e.target.value); productEl.value=rule.productNumber; typeEl.value=rule.type; mfgEl.value=rule.manufacturer; });

    document.getElementById('submitBtn').addEventListener('click', async ()=>{
      const errs = validateSingle(); if(errs.length){ showToast(errs[0],'warn'); return; }
      const body = payloadFromFields(hardwareTypeEl.value, assetTagEl.value, serialEl.value, modelEl.value, notesEl.value);
      const r = await postItem(body);
      if(r.ok){ assetTagEl.value=''; serialEl.value=''; notesEl.value=''; assetTagEl.focus(); }
    });

    document.getElementById('addToQueueBtn').addEventListener('click', ()=>{
      const errs = validateSingle(); if(errs.length){ showToast(errs[0],'warn'); return; }
      const body = payloadFromFields(hardwareTypeEl.value, assetTagEl.value, serialEl.value, modelEl.value, notesEl.value);
      const q = getQueue(); q.push(body); setQueue(q); showToast('Added to queue ('+q.length+')','ok');
      assetTagEl.value=''; serialEl.value=''; notesEl.value=''; assetTagEl.focus();
    });

    document.getElementById('resetBtn').addEventListener('click',()=>{
      hardwareTypeEl.value=''; modelEl.innerHTML='<option value="" selected>Select hardware type first…</option>'; modelEl.disabled=true; productEl.value=''; typeEl.value=''; mfgEl.value=''; notesEl.value=''; assetTagEl.value=''; serialEl.value=''; assetTagEl.focus();
    });

    serialEl.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); document.getElementById('submitBtn').click(); }});

    // ==== Batch events ====
    batchTypeEl.addEventListener('change', e=>{ fillModelOptionsFor(batchModelEl, e.target.value); batchAssetEl.focus(); });
    document.getElementById('batchAddBtn').addEventListener('click', ()=>{
      if(!batchTypeEl.value){ showToast('Select a hardware type','warn'); return; }
      if(!batchAssetEl.value){ showToast('Asset tag is required','warn'); return; }
      if(!batchSerialEl.value){ showToast('Serial number is required','warn'); return; }
      if(MODELS[batchTypeEl.value] && Object.keys(MODELS[batchTypeEl.value]).length && !batchModelEl.value){ showToast('Select a model','warn'); return; }
      const body = payloadFromFields(batchTypeEl.value, batchAssetEl.value, batchSerialEl.value, batchModelEl.value, '');
      const q = getQueue(); q.push(body); setQueue(q); showToast('Queued '+q.length+' item'+(q.length>1?'s':''),'ok');
      batchAssetEl.value=''; batchSerialEl.value=''; batchAssetEl.focus();
    });
    document.getElementById('goReviewBtn').addEventListener('click',()=> setTab('review'));

    // ==== Review rendering & actions ====
    function renderQueue(){
      const q = getQueue(); queueBody.innerHTML=''; queueCountPill.textContent = q.length + ' items';
      if(!q.length){ queueBody.innerHTML = '<tr><td colspan="10"><div class="hint">Queue is empty.</div></td></tr>'; return; }
      q.forEach((item, idx)=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `
          <td class="mono">${idx+1}</td>
          <td>
            <select class="mini" data-field="hardwareType">
              <option value="desktop" ${item.hardwareType==='desktop'?'selected':''}>Desktop</option>
              <option value="laptop" ${item.hardwareType==='laptop'?'selected':''}>Laptop</option>
              <option value="printer" ${item.hardwareType==='printer'?'selected':''}>Printer</option>
              <option value="tablet" ${item.hardwareType==='tablet'?'selected':''}>Tablet</option>
            </select>
          </td>
          <td>
            <select class="mini modelSel" data-field="model"></select>
          </td>
          <td><input class="mini" data-field="assetTag" value="${item.assetTag}"></td>
          <td><input class="mini" data-field="serialNumber" value="${item.serialNumber}"></td>
          <td><input class="mini" data-field="productNumber" value="${item.productNumber}" readonly></td>
          <td><input class="mini" data-field="manufacturer" value="${item.manufacturer}" readonly></td>
          <td><input class="mini" data-field="notes" value="${item.notes||''}"></td>
          <td>
            <button class="btn mini ghost" data-act="remove">Remove</button>
          </td>
          <td class="status mono">⏸</td>
        `;
        queueBody.appendChild(tr);

        // Initialize model options for the row
        const typeSel = tr.querySelector('select[data-field="hardwareType"]');
        const modelSel = tr.querySelector('select.modelSel');
        fillModelOptionsFor(modelSel, item.hardwareType);
        if(item.model){ modelSel.value = item.model; }

        // When type/model change, update auto fields
        typeSel.addEventListener('change', ev=>{
          const kind = ev.target.value; fillModelOptionsFor(modelSel, kind); modelSel.value='';
          const auto = autofillFrom(kind, '');
          tr.querySelector('input[data-field="productNumber"]').value = auto.productNumber;
          tr.querySelector('input[data-field="manufacturer"]').value = auto.manufacturer;
          persistRow(idx);
        });
        modelSel.addEventListener('change', ev=>{
          const kind = tr.querySelector('select[data-field="hardwareType"]').value;
          const auto = autofillFrom(kind, ev.target.value);
          tr.querySelector('input[data-field="productNumber"]').value = auto.productNumber;
          tr.querySelector('input[data-field="manufacturer"]').value = auto.manufacturer;
          persistRow(idx);
        });

        // Inputs persist
        tr.querySelectorAll('input').forEach(inp=> inp.addEventListener('input', ()=>persistRow(idx)));
        tr.querySelector('[data-act="remove"]').addEventListener('click', ()=>{ const q2=getQueue(); q2.splice(idx,1); setQueue(q2); renderQueue(); });
      });
    }

    function persistRow(idx){
      const tr = queueBody.children[idx];
      const kind = tr.querySelector('select[data-field="hardwareType"]').value;
      const modelName = tr.querySelector('select.modelSel').value;
      const auto = autofillFrom(kind, modelName);
      const item = {
        sheet: SHEET_NAME,
        timestamp: new Date().toISOString(),
        hardwareType: kind,
        model: modelName,
        assetTag: tr.querySelector('input[data-field="assetTag"]').value,
        serialNumber: tr.querySelector('input[data-field="serialNumber"]').value,
        productNumber: tr.querySelector('input[data-field="productNumber"]').value || auto.productNumber,
        type: auto.type,
        manufacturer: tr.querySelector('input[data-field="manufacturer"]').value || auto.manufacturer,
        notes: tr.querySelector('input[data-field="notes"]').value,
      };
      const q = getQueue(); q[idx]=item; setQueue(q);
    }

    document.getElementById('submitAllBtn').addEventListener('click', async ()=>{
      const q = getQueue(); if(!q.length){ showToast('Queue is empty','warn'); return; }
      // Validate quickly
      for(const [i,item] of q.entries()){
        if(!item.hardwareType || !item.assetTag || !item.serialNumber){ showToast(`Row ${i+1}: missing required fields`, 'warn'); setTab('review'); return; }
        if(MODELS[item.hardwareType] && Object.keys(MODELS[item.hardwareType]).length && !item.model){ showToast(`Row ${i+1}: select a model`, 'warn'); setTab('review'); return; }
      }
      // Submit sequentially to keep rate low and show status per row
      let ok=0, fail=0; 
      for(let i=0;i<q.length;i++){
        const statusCell = queueBody.children[i]?.querySelector('.status'); if(statusCell) statusCell.textContent = '…';
        const r = await postItem(q[i], statusCell);
        if(r.ok) ok++; else fail++;
      }
      if(fail===0){ setQueue([]); renderQueue(); }
      showToast(`Done. ${ok} ok, ${fail} failed`, fail? 'warn':'ok');
    });

    document.getElementById('clearQueueBtn').addEventListener('click', ()=>{ setQueue([]); renderQueue(); showToast('Queue cleared','ok'); });

    // ==== Init ====
    window.addEventListener('load', ()=>{ renderRecent(); assetTagEl.focus(); });
  </script>
</body>
</html>
